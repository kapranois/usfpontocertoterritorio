    <!-- Cabeçalho -->
    {% extends "base.html" %}

    {% block title %}{{ nome_equipe }} - Dashboard{% endblock %}

    {% block extra_css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    {% endblock %}

    {% block content %}
    <div class="content-wrapper">
        <!-- Banner do convidado (se aplicável) -->
        {% if not usuario_logado or nivel_usuario == 'convidado' %}
        <div class="convidado-banner">
            <div class="convidado-banner-content">
                <i class="fas fa-eye"></i>
                <div>
                    <strong>Modo Visitante</strong>
                    <p>Você está no modo de visualização apenas. Para editar conteúdo, faça login.</p>
                </div>
            </div>
            <button onclick="window.location.href='/login'">
                <i class="fas fa-sign-in-alt"></i> Fazer Login
            </button>
        </div>
        {% endif %}

        <!-- Métricas -->
        <section class="metrics">
            <div class="section-header-profissional">
                <h2>
                    <i class="fas fa-chart-pie"></i>
                    Resumo do Território
                    <span class="update-info">
                        Atualizado de acordo com cadastros dos ACS.
                    </span>
                </h2>
            </div>

            <div class="metrics-grid">
                <!-- Total de Moradores -->
                <div class="metric-card card-total" data-card-index="0">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="metric-title">
                            <h3>Total de Moradores</h3>
                            <div class="metric-value" id="totalMoradores">
                                {{ metricas.total_moradores }}
                            </div>
                        </div>
                    </div>
                    <div class="metric-info">
                        <p class="metric-description">
                            <i class="fas fa-home"></i>
                            População atendida
                        </p>
                    </div>
                </div>

                <!-- Hipertensos -->
                <div class="metric-card card-hipertensos" data-card-index="1">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                        <div class="metric-title">
                            <h3>Hipertensos</h3>
                            <div class="metric-value" id="totalHipertensos">
                                {{ metricas.total_hipertensos }}
                            </div>
                        </div>
                    </div>
                    <div class="metric-info">
                        <div class="metric-progress">
                            <div class="progress-info">
                                <span class="progress-label">Prevalência</span>
                                <span class="progress-percent" id="prevHipertensos">
                                    {% if metricas.total_moradores > 0 %}
                                    {{ ((metricas.total_hipertensos / metricas.total_moradores) * 100)|round(1) }}%
                                    {% else %}
                                    0%
                                    {% endif %}
                                </span>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar" data-width="{% if metricas.total_moradores > 0 %}{{ ((metricas.total_hipertensos / metricas.total_moradores) * 100)|round(1) }}{% else %}0{% endif %}"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Diabéticos -->
                <div class="metric-card card-diabeticos" data-card-index="2">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-prescription-bottle"></i>
                        </div>
                        <div class="metric-title">
                            <h3>Diabéticos</h3>
                            <div class="metric-value" id="totalDiabeticos">
                                {{ metricas.total_diabeticos }}
                            </div>
                        </div>
                    </div>
                    <div class="metric-info">
                        <div class="metric-progress">
                            <div class="progress-info">
                                <span class="progress-label">Prevalência</span>
                                <span class="progress-percent" id="prevDiabeticos">
                                    {% if metricas.total_moradores > 0 %}
                                    {{ ((metricas.total_diabeticos / metricas.total_moradores) * 100)|round(1) }}%
                                    {% else %}
                                    0%
                                    {% endif %}
                                </span>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar" data-width="{% if metricas.total_moradores > 0 %}{{ ((metricas.total_diabeticos / metricas.total_moradores) * 100)|round(1) }}{% else %}0{% endif %}"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Gestantes -->
                <div class="metric-card card-gestantes" data-card-index="3">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-female"></i>
                        </div>
                        <div class="metric-title">
                            <h3>Gestantes</h3>
                            <div class="metric-value" id="totalGestantes">
                                {{ metricas.total_gestantes }}
                            </div>
                        </div>
                    </div>
                    <div class="metric-info">
                        <div class="metric-progress">
                            <div class="progress-info">
                                <span class="progress-label">Proporção</span>
                                <span class="progress-percent" id="prevGestantes">
                                    {% if metricas.total_moradores > 0 %}
                                    {{ ((metricas.total_gestantes / metricas.total_moradores) * 100)|round(2) }}%
                                    {% else %}
                                    0%
                                    {% endif %}
                                </span>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar" data-width="{% if metricas.total_moradores > 0 %}{{ ((metricas.total_gestantes / metricas.total_moradores) * 100)|round(2) }}{% else %}0{% endif %}"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cobertura Geral -->
                <div class="metric-card card-cobertura" data-card-index="4">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <div class="metric-title">
                            <h3>Cobertura Geral</h3>
                            <div class="metric-value" id="coberturaGeral">
                                {{ metricas.cobertura_geral|default(0) }}%
                            </div>
                        </div>
                    </div>
                    <div class="metric-info">
                        <div class="metric-progress">
                            <div class="progress-info">
                                <span class="progress-label">Cobertura do território</span>
                                <span class="progress-percent">{{ metricas.cobertura_geral|default(0) }}%</span>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar" data-width="{{ metricas.cobertura_geral|default(0) }}"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Condomínios Cobertos -->
                <div class="metric-card card-status" data-card-index="5">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="metric-title">
                            <h3>Cobertos</h3>
                            <div class="metric-value" id="totalCobertos">
                                {% set cobertos = condominios|selectattr('status_cobertura', 'equalto', 'completo')|list|length %}
                                {{ cobertos }}
                            </div>
                        </div>
                    </div>
                    <div class="metric-info">
                        <p class="metric-description">
                            <i class="fas fa-building"></i>
                            {{ (cobertos / condominios|length * 100)|round(1) if condominios|length > 0 else 0 }}% dos condomínios
                        </p>
                        <div class="mini-chart">
                            {% for i in range(5) %}
                            <div class="chart-bar">
                                <div class="chart-fill" data-height="{% if i < (cobertos / condominios|length * 5 if condominios|length > 0 else 0) %}100{% else %}0{% endif %}"></div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <!-- Condomínios Parciais -->
                <div class="metric-card card-status" data-card-index="6">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="metric-title">
                            <h3>Parciais</h3>
                            <div class="metric-value" id="totalParciais">
                                {% set parciais = condominios|selectattr('status_cobertura', 'equalto', 'parcial')|list|length %}
                                {{ parciais }}
                            </div>
                        </div>
                    </div>
                    <div class="metric-info">
                        <p class="metric-description">
                            <i class="fas fa-building"></i>
                            {{ (parciais / condominios|length * 100)|round(1) if condominios|length > 0 else 0 }}% dos condomínios
                        </p>
                        <div class="mini-chart">
                            {% for i in range(5) %}
                            <div class="chart-bar">
                                <div class="chart-fill" data-height="{% if i < (parciais / condominios|length * 5 if condominios|length > 0 else 0) %}100{% else %}0{% endif %}"></div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <!-- Condomínios Descobertos -->
                <div class="metric-card card-status" data-card-index="7">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <div class="metric-title">
                            <h3>Descobertos</h3>
                            <div class="metric-value" id="totalDescobertos">
                                {% set descobertos = condominios|selectattr('status_cobertura', 'equalto', 'descoberto')|list|length %}
                                {{ descobertos }}
                            </div>
                        </div>
                    </div>
                    <div class="metric-info">
                        <p class="metric-description">
                            <i class="fas fa-building"></i>
                            {{ (descobertos / condominios|length * 100)|round(1) if condominios|length > 0 else 0 }}% dos condomínios
                        </p>
                        <div class="mini-chart">
                            {% for i in range(5) %}
                            <div class="chart-bar">
                                <div class="chart-fill" data-height="{% if i < (descobertos / condominios|length * 5 if condominios|length > 0 else 0) %}100{% else %}0{% endif %}"></div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <div class="metrics-summary">
                <div>
                    <i class="fas fa-info-circle"></i>
                    <strong>Resumo:</strong>
                    {{ condominios|length }} condomínios •
                    {{ metricas.total_moradores }} moradores •
                    {{ metricas.cobertura_geral|default(0) }}% de cobertura
                </div>
                <div>
                    <i class="fas fa-sync-alt" onclick="dashboard.atualizarMetricas()" title="Atualizar dados"></i>
                    Última atualização: <span id="lastUpdateTime">--:--</span>
                </div>
            </div>
        </section>

        
    </div>
    {% endblock %}

    {% block extra_js %}
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
    <script>
        // Configuração do usuário para JavaScript
        window.APP_CONFIG = {
            usuario_logado: {% if usuario_logado %}true{% else %}false{% endif %},
            nome_usuario: {{ nome_usuario|default('Visitante')|tojson }},
            nivel_usuario: {{ nivel_usuario|default('')|tojson }},
            nome_equipe: {{ nome_equipe|tojson }},
            condominios_count: {{ condominios|length }},
            metricas: {
                total_moradores: {{ metricas.total_moradores }},
                total_hipertensos: {{ metricas.total_hipertensos }},
                total_diabeticos: {{ metricas.total_diabeticos }},
                total_gestantes: {{ metricas.total_gestantes }},
                cobertura_geral: {{ metricas.cobertura_geral|default(0) }}
            }
        };

        // Inicializar dashboard quando o DOM estiver pronto
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof dashboard !== 'undefined') {
                dashboard.init();
            }
        });
    </script>
    {% endblock %}
</body>
</html>
