    <!-- Cabeçalho -->
    {% extends "base.html" %}

    {% block title %}{{ nome_equipe }} - Dashboard{% endblock %}

    {% block extra_css %}
    <!-- CSS específico do dashboard -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    {% endblock %}

    {% block content %}
    <div class="content-wrapper">
        <!-- Banner do convidado (se aplicável) -->
        {% if not usuario_logado or nivel_usuario == 'convidado' %}
        <div class="convidado-banner">
            <div class="convidado-banner-content">
                <i class="fas fa-eye"></i>
                <div>
                    <strong>Modo Visitante</strong>
                    <p>Você está no modo de visualização apenas. Para editar conteúdo, faça login.</p>
                </div>
            </div>
            <button onclick="window.location.href='/login'">
                <i class="fas fa-sign-in-alt"></i> Fazer Login
            </button>
        </div>
        {% endif %}

        <!-- Métricas -->
        <section class="metrics">
            <div class="section-header-profissional">
                <h2>
                    <i class="fas fa-chart-pie"></i>
                    Resumo do Território
                    <span class="update-info">
                        Atualizado em tempo real
                    </span>
                </h2>
            </div>

            <div class="metrics-grid">
                <!-- Total de Moradores -->
                <div class="metric-card card-total" data-card-index="0">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="metric-title">
                            <h3>Total de Moradores</h3>
                            <div class="metric-value" id="totalMoradores">
                                {{ metricas.total_moradores }}
                            </div>
                        </div>
                    </div>
                    <div class="metric-info">
                        <p class="metric-description">
                            <i class="fas fa-home"></i>
                            População atendida
                        </p>
                    </div>
                </div>

                <!-- Hipertensos -->
                <div class="metric-card card-hipertensos" data-card-index="1">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                        <div class="metric-title">
                            <h3>Hipertensos</h3>
                            <div class="metric-value" id="totalHipertensos">
                                {{ metricas.total_hipertensos }}
                            </div>
                        </div>
                    </div>
                    <div class="metric-info">
                        <div class="metric-progress">
                            <div class="progress-info">
                                <span class="progress-label">Prevalência</span>
                                <span class="progress-percent" id="prevHipertensos">
                                    {% if metricas.total_moradores > 0 %}
                                    {{ ((metricas.total_hipertensos / metricas.total_moradores) * 100)|round(1) }}%
                                    {% else %}
                                    0%
                                    {% endif %}
                                </span>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar" data-width="{% if metricas.total_moradores > 0 %}{{ ((metricas.total_hipertensos / metricas.total_moradores) * 100)|round(1) }}{% else %}0{% endif %}"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Diabéticos -->
                <div class="metric-card card-diabeticos" data-card-index="2">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-prescription-bottle"></i>
                        </div>
                        <div class="metric-title">
                            <h3>Diabéticos</h3>
                            <div class="metric-value" id="totalDiabeticos">
                                {{ metricas.total_diabeticos }}
                            </div>
                        </div>
                    </div>
                    <div class="metric-info">
                        <div class="metric-progress">
                            <div class="progress-info">
                                <span class="progress-label">Prevalência</span>
                                <span class="progress-percent" id="prevDiabeticos">
                                    {% if metricas.total_moradores > 0 %}
                                    {{ ((metricas.total_diabeticos / metricas.total_moradores) * 100)|round(1) }}%
                                    {% else %}
                                    0%
                                    {% endif %}
                                </span>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar" data-width="{% if metricas.total_moradores > 0 %}{{ ((metricas.total_diabeticos / metricas.total_moradores) * 100)|round(1) }}{% else %}0{% endif %}"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gestantes -->
                <div class="metric-card card-gestantes" data-card-index="3">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-female"></i>
                        </div>
                        <div class="metric-title">
                            <h3>Gestantes</h3>
                            <div class="metric-value" id="totalGestantes">
                                {{ metricas.total_gestantes }}
                            </div>
                        </div>
                    </div>
                    <div class="metric-info">
                        <div class="metric-progress">
                            <div class="progress-info">
                                <span class="progress-label">Proporção</span>
                                <span class="progress-percent" id="prevGestantes">
                                    {% if metricas.total_moradores > 0 %}
                                    {{ ((metricas.total_gestantes / metricas.total_moradores) * 100)|round(2) }}%
                                    {% else %}
                                    0%
                                    {% endif %}
                                </span>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar" data-width="{% if metricas.total_moradores > 0 %}{{ ((metricas.total_gestantes / metricas.total_moradores) * 100)|round(2) }}{% else %}0{% endif %}"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cobertura Geral -->
                <div class="metric-card card-cobertura" data-card-index="4">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <div class="metric-title">
                            <h3>Cobertura Geral</h3>
                            <div class="metric-value" id="coberturaGeral">
                                {{ metricas.cobertura_geral|default(0) }}%
                            </div>
                        </div>
                    </div>
                    <div class="metric-info">
                        <div class="metric-progress">
                            <div class="progress-info">
                                <span class="progress-label">Cobertura do território</span>
                                <span class="progress-percent">{{ metricas.cobertura_geral|default(0) }}%</span>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar" data-width="{{ metricas.cobertura_geral|default(0) }}"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Condomínios Cobertos -->
                <div class="metric-card card-status" data-card-index="5">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="metric-title">
                            <h3>Cobertos</h3>
                            <div class="metric-value" id="totalCobertos">
                                {% set cobertos = condominios|selectattr('status_cobertura', 'equalto', 'completo')|list|length %}
                                {{ cobertos }}
                            </div>
                        </div>
                    </div>
                    <div class="metric-info">
                        <p class="metric-description">
                            <i class="fas fa-building"></i>
                            {{ (cobertos / condominios|length * 100)|round(1) if condominios|length > 0 else 0 }}% dos condomínios
                        </p>
                        <div class="mini-chart">
                            {% for i in range(5) %}
                            <div class="chart-bar">
                                <div class="chart-fill" data-height="{% if i < (cobertos / condominios|length * 5 if condominios|length > 0 else 0) %}100{% else %}0{% endif %}"></div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <!-- Condomínios Parciais -->
                <div class="metric-card card-status" data-card-index="6">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="metric-title">
                            <h3>Parciais</h3>
                            <div class="metric-value" id="totalParciais">
                                {% set parciais = condominios|selectattr('status_cobertura', 'equalto', 'parcial')|list|length %}
                                {{ parciais }}
                            </div>
                        </div>
                    </div>
                    <div class="metric-info">
                        <p class="metric-description">
                            <i class="fas fa-building"></i>
                            {{ (parciais / condominios|length * 100)|round(1) if condominios|length > 0 else 0 }}% dos condomínios
                        </p>
                        <div class="mini-chart">
                            {% for i in range(5) %}
                            <div class="chart-bar">
                                <div class="chart-fill" data-height="{% if i < (parciais / condominios|length * 5 if condominios|length > 0 else 0) %}100{% else %}0{% endif %}"></div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <!-- Condomínios Descobertos -->
                <div class="metric-card card-status" data-card-index="7">
                    <div class="metric-header">
                        <div class="metric-icon">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <div class="metric-title">
                            <h3>Descobertos</h3>
                            <div class="metric-value" id="totalDescobertos">
                                {% set descobertos = condominios|selectattr('status_cobertura', 'equalto', 'descoberto')|list|length %}
                                {{ descobertos }}
                            </div>
                        </div>
                    </div>
                    <div class="metric-info">
                        <p class="metric-description">
                            <i class="fas fa-building"></i>
                            {{ (descobertos / condominios|length * 100)|round(1) if condominios|length > 0 else 0 }}% dos condomínios
                        </p>
                        <div class="mini-chart">
                            {% for i in range(5) %}
                            <div class="chart-bar">
                                <div class="chart-fill" data-height="{% if i < (descobertos / condominios|length * 5 if condominios|length > 0 else 0) %}100{% else %}0{% endif %}"></div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <div class="metrics-summary">
                <div>
                    <i class="fas fa-info-circle"></i>
                    <strong>Resumo:</strong>
                    {{ condominios|length }} condomínios •
                    {{ metricas.total_moradores }} moradores •
                    {{ metricas.cobertura_geral|default(0) }}% de cobertura
                </div>
                <div>
                    <i class="fas fa-sync-alt" onclick="dashboard.atualizarMetricas()" title="Atualizar dados"></i>
                    Última atualização: <span id="lastUpdateTime">--:--</span>
                </div>
            </div>
        </section>

        <!-- Seção: Equipe Multiprofissional - Design Premium -->
        <section class="equipe-premium-section">
            <div class="section-header-premium">
                <div class="section-title-container">
                    <h2><i class="fas fa-users-medical"></i> Equipe Multiprofissional</h2>
                    <p class="section-subtitle">Profissionais dedicados ao cuidado do território</p>
                </div>
                <div class="section-stats">
                    <div class="stat-item">
                        <i class="fas fa-user-md"></i>
                        <div>
                            <span class="stat-number" id="totalProfissionais">
                                {% if equipe_profissionais %}
                                {% set total = 0 %}
                                {% if equipe_profissionais.get('acs') %}{% set total = total + equipe_profissionais.get('acs')|length %}{% endif %}
                                {% if equipe_profissionais.get('enfermeiro') %}{% set total = total + 1 %}{% endif %}
                                {% if equipe_profissionais.get('medico') %}{% set total = total + 1 %}{% endif %}
                                {{ total }}
                                {% else %}
                                0
                                {% endif %}
                            </span>
                            <span class="stat-label">Profissionais</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-shield-alt"></i>
                        <div>
                            <span class="stat-number">{{ condominios|length }}</span>
                            <span class="stat-label">Condomínios</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-heartbeat"></i>
                        <div>
                            <span class="stat-number">{{ metricas.total_moradores }}</span>
                            <span class="stat-label">Moradores</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="equipe-grid-premium">
                <!-- Agentes Comunitários de Saúde -->
                <div class="profissional-card premium-card acs-card">
                    <div class="card-badge">Território</div>
                    <div class="card-header-premium">
                        <div class="card-icon-premium">
                            <i class="fas fa-user-md"></i>
                        </div>
                        <div class="card-title-premium">
                            <h3>Agentes Comunitários</h3>
                            <div class="card-subtitle">ACS - Contato direto com a comunidade</div>
                        </div>
                        <div class="card-metric">
                            <span class="metric-label">Ativos</span>
                            <span class="metric-value">
                                {% if equipe_profissionais and equipe_profissionais.get('acs') %}
                                {{ equipe_profissionais.get('acs')|selectattr('ativo', 'equalto', true)|list|length }}
                                {% else %}0{% endif %}
                            </span>
                        </div>
                    </div>

                    <div class="profissionais-lista-premium" id="lista-acs-premium">
                        {% if equipe_profissionais and equipe_profissionais.get('acs') %}
                        {% set acs_list = equipe_profissionais.get('acs', []) %}
                        {% set acs_ativos = acs_list|selectattr('ativo', 'equalto', true) %}
                        {% set acs_ativos_list = acs_ativos|list %}

                        {% for acs in acs_ativos_list[:4] %}
                        <div class="profissional-item-premium" data-acs='{{ acs|tojson }}'>
                            <div class="profissional-avatar">
                                <div class="avatar-circle">
                                    <i class="fas fa-user-md"></i>
                                </div>
                                <div class="avatar-status online"></div>
                            </div>
                            <div class="profissional-info-premium">
                                <div class="profissional-nome-premium">{{ acs.nome }}</div>
                                <div class="profissional-detalhes-premium">
                                    <span class="detalhe-item">
                                        <i class="fas fa-id-card"></i>
                                        {{ acs.registro|default('N/I') }}
                                    </span>
                                    {% if acs.telefone %}
                                    <span class="detalhe-item">
                                        <i class="fas fa-map-pin"></i>
                                        Microárea: {{ acs.microarea|default('Não informada') }}
                                    </span>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="profissional-action">
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                        {% endfor %}

                        {% if acs_ativos_list|length > 4 %}
                        <div class="ver-mais-premium" data-acs-data='{{ acs_ativos_list|tojson }}'>
                            <div class="ver-mais-content">
                                <i class="fas fa-plus-circle"></i>
                                <span>Ver mais {{ acs_ativos_list|length - 4 }} agentes</span>
                            </div>
                        </div>
                        {% endif %}

                        {% else %}
                        <div class="empty-profissionais">
                            <i class="fas fa-user-slash"></i>
                            <p>Nenhum ACS cadastrado</p>
                            <small>Equipe em formação</small>
                        </div>
                        {% endif %}
                    </div>

                    <div class="card-footer-premium">
                        <div class="footer-info">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>Cobertura total do território</span>
                        </div>
                        <button class="btn-card-action btn-adicionar-acs">
                            <i class="fas fa-user-plus"></i>
                            Adicionar
                        </button>
                    </div>
                </div>

                <!-- Enfermeiro Responsável -->
                <div class="profissional-card premium-card enfermeiro-card">
                    <div class="card-badge">Coordenação</div>
                    <div class="card-header-premium">
                        <div class="card-icon-premium">
                            <i class="fas fa-user-nurse"></i>
                        </div>
                        <div class="card-title-premium">
                            <h3>Enfermeiro Responsável</h3>
                            <div class="card-subtitle">Supervisão e coordenação</div>
                        </div>
                        <div class="card-metric">
                            <span class="metric-label">Status</span>
                            <span class="metric-value status-active">
                                {% if equipe_profissionais and equipe_profissionais.get('enfermeiro') %}
                                Ativo
                                {% else %}
                                Pendente
                                {% endif %}
                            </span>
                        </div>
                    </div>

                    <div class="profissionais-lista-premium">
                        {% if equipe_profissionais and equipe_profissionais.get('enfermeiro') %}
                        {% set enfermeiro = equipe_profissionais.get('enfermeiro') %}
                        <div class="profissional-destaque" data-enfermeiro='{{ enfermeiro|tojson }}'>
                            <div class="destaque-avatar">
                                <div class="avatar-circle-large">
                                    <i class="fas fa-user-nurse"></i>
                                </div>
                            </div>
                            <div class="destaque-info">
                                <h4>{{ enfermeiro.nome }}</h4>
                                <div class="destaque-detalhes">
                                    <span class="detalhe-destaque">
                                        <i class="fas fa-id-card"></i>
                                        {{ enfermeiro.registro|default('N/I') }}
                                    </span>
                                    {% if enfermeiro.especializacao %}
                                    <span class="detalhe-destaque">
                                        <i class="fas fa-graduation-cap"></i>
                                        {{ enfermeiro.especializacao }}
                                    </span>
                                    {% endif %}
                                </div>
                                {% if enfermeiro.telefone %}
                                <div class="destaque-contato">
                                    <i class="fas fa-phone"></i>
                                    {{ enfermeiro.telefone }}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% else %}
                        <div class="empty-destaque">
                            <div class="empty-icon">
                                <i class="fas fa-user-clock"></i>
                            </div>
                            <h4>Posição em aberto</h4>
                            <p>Enfermeiro não designado</p>
                            <button class="btn-designar btn-designar-enfermeiro">
                                <i class="fas fa-user-plus"></i>
                                Designar Enfermeiro
                            </button>
                        </div>
                        {% endif %}
                    </div>

                    <div class="card-footer-premium">
                        <div class="footer-info">
                            <i class="fas fa-tasks"></i>
                            <span>Coordenação da equipe ACS</span>
                        </div>
                        {% if equipe_profissionais and equipe_profissionais.get('enfermeiro') %}
                        <button class="btn-card-action btn-ver-enfermeiro" data-enfermeiro='{{ enfermeiro|tojson }}'>
                            <i class="fas fa-eye"></i>
                            Ver detalhes
                        </button>
                        {% endif %}
                    </div>
                </div>

                <!-- Médico Responsável -->
                <div class="profissional-card premium-card medico-card">
                    <div class="card-badge">Especialista</div>
                    <div class="card-header-premium">
                        <div class="card-icon-premium">
                            <i class="fas fa-stethoscope"></i>
                        </div>
                        <div class="card-title-premium">
                            <h3>Médico Responsável</h3>
                            <div class="card-subtitle">Referência técnica</div>
                        </div>
                        <div class="card-metric">
                            <span class="metric-label">Status</span>
                            <span class="metric-value status-active">
                                {% if equipe_profissionais and equipe_profissionais.get('medico') %}
                                Ativo
                                {% else %}
                                Pendente
                                {% endif %}
                            </span>
                        </div>
                    </div>

                    <div class="profissionais-lista-premium">
                        {% if equipe_profissionais and equipe_profissionais.get('medico') %}
                        {% set medico = equipe_profissionais.get('medico') %}
                        <div class="profissional-destaque" data-medico='{{ medico|tojson }}'>
                            <div class="destaque-avatar">
                                <div class="avatar-circle-large">
                                    <i class="fas fa-user-md"></i>
                                </div>
                            </div>
                            <div class="destaque-info">
                                <h4>{{ medico.nome }}</h4>
                                <div class="destaque-detalhes">
                                    <span class="detalhe-destaque">
                                        <i class="fas fa-id-card"></i>
                                        {{ medico.registro|default('N/I') }}
                                    </span>
                                    {% if medico.especializacao %}
                                    <span class="detalhe-destaque">
                                        <i class="fas fa-heartbeat"></i>
                                        {{ medico.especializacao }}
                                    </span>
                                    {% endif %}
                                </div>
                                {% if medico.telefone %}
                                <div class="destaque-contato">
                                    <i class="fas fa-phone"></i>
                                    {{ medico.telefone }}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% else %}
                        <div class="empty-destaque">
                            <div class="empty-icon">
                                <i class="fas fa-user-clock"></i>
                            </div>
                            <h4>Posição em aberto</h4>
                            <p>Médico não designado</p>
                            <button class="btn-designar btn-designar-medico">
                                <i class="fas fa-user-plus"></i>
                                Designar Médico
                            </button>
                        </div>
                        {% endif %}
                    </div>

                    <div class="card-footer-premium">
                        <div class="footer-info">
                            <i class="fas fa-star"></i>
                            <span>Referência técnica da equipe</span>
                        </div>
                        {% if equipe_profissionais and equipe_profissionais.get('medico') %}
                        <button class="btn-card-action btn-ver-medico" data-medico='{{ medico|tojson }}'>
                            <i class="fas fa-eye"></i>
                            Ver detalhes
                        </button>
                        {% endif %}
                    </div>
                </div>
            </div>
        </section>
    </div>
    {% endblock %}

    {% block extra_js %}
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
    <script>
        // Configuração do usuário para JavaScript
        window.APP_CONFIG = {
            usuario_logado: {% if usuario_logado %}true{% else %}false{% endif %},
            nome_usuario: {{ nome_usuario|default('Visitante')|tojson }},
            nivel_usuario: {{ nivel_usuario|default('')|tojson }},
            nome_equipe: {{ nome_equipe|tojson }},
            condominios_count: {{ condominios|length }},
            metricas: {
                total_moradores: {{ metricas.total_moradores }},
                total_hipertensos: {{ metricas.total_hipertensos }},
                total_diabeticos: {{ metricas.total_diabeticos }},
                total_gestantes: {{ metricas.total_gestantes }},
                cobertura_geral: {{ metricas.cobertura_geral|default(0) }}
            }
        };

        // Inicializar dashboard quando o DOM estiver pronto
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof dashboard !== 'undefined') {
                dashboard.init();
            }
        });
    </script>
    {% endblock %}
</body>
</html>
